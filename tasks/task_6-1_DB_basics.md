#  Домашнее задание к занятию "6.1. Типы и структура СУБД"

Q1: Архитектор ПО решил проконсультироваться у вас, какой тип БД лучше выбрать для хранения определенных данных.
Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.

Архитектор предоставил следующие типы сущностей, которые нужно будет хранить в БД:

Q1.1: Электронные чеки в json виде  
A1.1: Предлагаю документо-ориентированную СУБД, которая толерантна к формату и структуре хранимого документа. Содержание чека может быть разным в зависимости от вида товара, магазина, способа оплаты, количества товаров в чеке. А еще формат чека может поменяться со временем законодательно.  
Q1.2: Склады и автомобильные дороги для логистической компании  
A1.2: Предлагаю графовую СУБД. В ней удобно хранить склады как объекты, а связывающие склады дороги хорошо укладываются в концепцию ребер графа с соответствующими параметрами: протяженность, необходимость оплаты, наличие АЗС, загруженность в течение дня.  
Q1.3: Генеалогические деревья  
A1.3: Предлагаю сетевую СУБД, чтобы можно было записывать связь с двумя родителями и связывать каждого родителя с произвольным числом детей. Также можно было бы обойтись и реляционной СУБД - вряд ли в чьем-то генеалогическом дереве в ближайшем будущем потребуется записывать больше 2 родителей, так что структуру данных вполне можно определить сразу.  
Q1.4: Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации  
A1.4: СУБД вида "key-value" с возможностью присваивать записям параметр Time-To-Live. (Похоже без Redis надо освоить:)))  
Q1.5: Отношения клиент-покупка для интернет-магазина  
A1.5: Звучит как таблица из реляционной СУБД. Если же это единственные данные, про которые уже что-то известно, то разумно начать с документо-ориентированной СУБД - уж очень неконкретно описаны понятия "клиент" и "покупка" - что собой представляют эти данные?!

---
Q2: Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если (каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):

Q2.1: Данные записываются на все узлы с задержкой до часа (асинхронная запись)  
A2.2:
  - В координатах CAP это CP - данные на всех узлах записаны. Если узел отвалился, то с других узлов можно надежно получить данные, но задержки до часа - это уже не А. А еще это может быть и PA, если так хочет заказчик - пусть данные будут не согласованы (задержка в час к этому явно располагает), но зато отвечает быстро.
  - В координатах PACELC это может быть PA/EL, если в случае потери связи важнее скорость ответа, но может  быть и PC/EC, если доступность неважно и можно подождать час и более.

Q2.2: При сетевых сбоях, система может разделиться на 2 раздельных кластера  
A2.2:
  - В CAP - CP, если один из кластеров выключается из обработки запросов. Если оставить оба кластера, то можно назвать AP - тут уж какой кластер ответит, такой ответит, и что за данные будут в ответе - решать балансировщику:)
  - В PACELC - PA/EL или PA/EC  

Q2.3: Система может не прислать корректный ответ или сбросить соединение  
A2.3:
  - CAP - PС. Из всех предложенных случаев только этот я могу трактовать как-то однозначно, исходя из формулировки вопроса.
  - PACELC - PC/EC - система явно нацелена отдавать ТОЛЬКО правильные данные.  
P.S. Мне почему-то не удается дать однозначный ответ на формулировки вопросов 1 и 2 в этой задаче:(

---
Q3: Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?  
A3: Ответ - нет.
- система либо стремится к полной согласованности (ACID), либо разрешает себе отвечать неверными данными, зато быстро.
- параллельные запросы либо не влияют на результаты ответа друг друга (ACID), либо это касается только некоторых критичных данных/состояний системы хранения (BASE).  


---
Q4: Вам дали задачу написать системное решение, основой которого бы послужили:

фиксация некоторых значений с временем жизни
реакция на истечение таймаута
Вы слышали о key-value хранилище, которое имеет механизм Pub/Sub. Q4.1: Что это за система?  
A4.1: Это система рассылки сообщений/данных от Издетеля (pub) в адрес Подписчиков (sub). В этой системе сообщения делятся на классы, Подписчики выбирают, на какой класс они подписываются, не зная автора (Издателя). Посредником между Pub's и Sub's является система, в которой размещаются сообщения от Издателей, а Подписчики регистрируются на сообщения определенного класса. В целом интересный шаблон конструирования - изоляция сущностей и масштабируемость за счет дополнительного уровня абстракции. Был рад узнать про такой шаблон.
Q4.2: Какие минусы выбора данной системы?  
A4.2:
  - вообще, похоже, вопросов в плане конкретной реализации конструкции достаточно много: кто инициирует события, кто следит за очередями и т.п.
  - наличие абстракции Pub/Sub-системы, через которую осуществляется общение Издателей и Подписчиков, создает узкое место - ее отказ или высокая загрузка автоматически привлекают внимание и делают эту сущность узким местом и уязвимостью... зато можно говорить о консистентности:)

---
# ДОРАБОТКА

Q2: Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если (каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):

Q2.1: Данные записываются на все узлы с задержкой до часа (асинхронная запись)  
A2.2:
  - PA: данные будут не согласованы (задержка в час к этому явно располагает), но зато сервер отвечает, даже если разделить сеть.
  - В координатах PACELC это может быть PA/EL, если в случае потери связи важнее скорость ответа.

Q2.2: При сетевых сбоях, система может разделиться на 2 раздельных кластера  
A2.2:
  - В CAP - PA: две части кластера живут своей жизнью, данные в них разные.
  - В PACELC - PA/EL или PA/EC  

Q2.3: Система может не прислать корректный ответ или сбросить соединение  
A2.3:
  - CAP - PС. Из всех предложенных случаев только этот я могу трактовать как-то однозначно, исходя из формулировки вопроса.
  - PACELC - PC/EC - система явно нацелена отдавать ТОЛЬКО правильные данные.  
